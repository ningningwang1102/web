"use strict";$define("pl_readyload",["pl_util","cmsAjax","md5"],function(t,r,n){function s(t,n){var e=t.business,i=t.dataid,t=t.sourceid,a="like"==e?"点赞":"dislike"==e?"点踩":"";switch(e){case"like":a="点赞";break;case"dislike":a="点踩";break;case"visits":a="页面访问";break;case"videoPlay":a="视频播放"}e&&i&&t&&(t={tenantId:window.tenant.tenantId,business:e,businessName:a,sourceIds:i,tid:t},r.cmsAjax.postJson("/mwebapi/batch/counter/add",t).then(function(t){t.data&&n&&"function"==typeof n&&n(a)}))}function e(e){function t(a){function t(i){var t={business:[i],sourceIds:e[a][i].sourceIds,tid:a,tenantId:window.tenant.tenantId,todayFlag:e[a][i].todayFlag};r.cmsAjax.postJson("/mwebapi/batch/counter/find",t).then(function(t){var n,e,s;n=t.data,t=[i],e=a,s=n.counter,t.forEach(function(o){var t=$('[class^="e_assist-"][type="'.concat(o,'"][sourceid="').concat(e,'"]'));"videoPlay"==o&&(t=$('[class^="e_assist-"][type="'.concat(o,'"]'))),t.each(function(t,n){var e,i=parseInt($(n).attr("num"))||0,a=$(n).attr("dataid")||"";!a||(e=s.find(function(t){return t.sourceId==a}))&&(i=parseInt(e.counterDetail[o])+i,$(n).find(".p_num").html(i))})})})}for(var n in e[a])t(n)}for(var n in e)t(n)}var o=function(){isFrontEnv()&&window.pageObj&&"1"==window.pageObj.visualx?r.cmsAjax.get(location.origin+"/js/visualx.json").then(function(n){$(window).width()<n.closed?i():$require(["locomotive"],function(t){t.init(n,function(){i()})})}).catch(function(t){i()}):i()},i=function(){$require(["newAnimat"],function(t){t.init()})},d={},c=function(){var n,t;$("body").on("click",'[class^="e_assist-"] .p_icon',function(){var n,t,e,i=Number($(this).attr("count")),a=Number($(this).attr("counted"));isNaN(a)&&(a=0),isNaN(i)&&(i=0),0!=i&&i<=a||(a++,$(this).attr("counted",a),(t=$(this).attr("active")||"")&&a==i&&$(this).css({color:t}),t={business:(n=$(this).parent()).attr("type")||"",dataid:n.attr("dataid")||"",sourceid:n.attr("sourceid")||""},e=parseInt(n.find(".p_num").text()),s(t,function(t){n.find(".p_num").text(e+1)}))}),window.pageObj&&"3"==window.pageObj.pageType&&(n="",window.pageObj._detailId?n=pageObj._detailId:window.location.pathname.split("/").forEach(function(t){/^(\d|-)+(\.html)$/.test(t)&&(n=(n=t.split(".")[0]).split("-")[0])}),t={business:"visits",dataid:n,sourceid:pageObj.appId+"_"+pageObj.contentType},s(t,function(){})),$("body").find("video").each(function(t,n){var e,i,a=$(n).attr("src"),o=(/^http/.test(i=e=a)?((a=e.split("//")[1].split("/")).splice(0,1),i=a.join("/")):/^\/repository/.test(e)&&(i=e.split("/repository/")[1]),i);$(n).get(0).addEventListener("play",function(){var t;d[o]||(d[o]=1,t={business:"videoPlay",dataid:o,sourceid:window.tenant.tenantId+"_video"},s(t,function(){}))})})},l=function(){var s={};$('[class^="e_assist-"]').each(function(t,i){var a=$(i).attr("type")||"",n=$(i).attr("dataid")||"",e=$(i).attr("sourceid")||"";"videoPlay"==a&&(e=window.tenant.tenantId+"_video");var o="true"==$(i).attr("today");if("pvData"!=a&&"fwData"!=a){if(!a||!n||!e)return!0;s[e]||(s[e]={}),s[e][a]||(s[e][a]={sourceIds:[],todayFlag:o}),-1==s[e][a].sourceIds.indexOf(n)&&s[e][a].sourceIds.push(n)}else{n={tenantId:tenant.tenantId,cacheType:"1"};r.cmsAjax.postJson("https://mdm-v2.yun300.cn/flow-statistics-v2api/indexPage",n).then(function(t){var n={};try{n=t.data.summary.hisTotal}catch(t){}var e="pvData"==a?n.pv:n.session;$(i).find(".p_num").text(e)})}}),e(s)},a=function(){for(var t,n,e,i=$("div[id^='c_']"),a=$(),o=0;o<i.length;o++)if(t=$(i[o]),t.offset().top<=$(document).scrollTop()+$(window).height()&&(a=(a=(a=(a=$()).add(t.find("img[lazy]"))).add(t.find("img[needError]"))).add(t.find("img[src='/']"))).length)for(e=0;e<a.length;e++){var s,r,d=(n=a.eq(e)).attr("lazy");n.offset().top<=$(document).scrollTop()+$(window).height()&&d&&(0<n.parents('[id^="c_magiccube_009"]').length&&n.closest("div").is(":hidden")||((s=n.attr("lazy"))&&"/"!=s&&-1==s.indexOf("img-none-big.png")?(r=n.attr("lazy").split("?")[0].toLowerCase(),d="false"!=n.attr("needthumb"),-1==r.indexOf("portal-saas/")&&-1==r.indexOf("shop/")||!d||(s=function(t){for(var n,e=[104,186,290,366,560,640,1180,1920],i=t.attr("lazy"),a=i.indexOf("?")?i.split("?")[1]:"",o=i.split("?")[0],s=t,r=0;r<5;r++){if(!(0==s.parent().width()||null==s.parent().width()||s.parent().width()==t.width()&&s.parent().width()<104||10==s.parent().width())){n=s.parent().width();break}s=s.parent()}0<n&&n<t.width()&&(n=t.width());n=n||0;for(var d=null,r=0;r<e.length;r++)if(0<e[r]-n){d=r;break}if(null==d||0==n)return i;a=a?"?"+a:"";return o+"_"+e[d]+"xaf"+o.substr(o.lastIndexOf("."))+a}(n)),-1!==r.indexOf(".aiyouyi.cn/web-file/")&&(s=function(t){var n,e=t.attr("lazy"),i=t;if(t.is(":hidden"))n=t.parents().not(":hidden").width();else for(var a=0;a<5;a++){if(0!=i.parent().width()&&null!=i.parent().width()){n=i.parent().width();break}i=i.parent()}0<n&&n<t.width()&&(n=t.width());(!n||n<0)&&(n=0);{var o,s;0!=n&&(window.imgRandom||(window.imgRandom=new Map),o="",s=window.imgRandom.get("img"),o=3==s?1:1==s?2:2==s?3:Math.ceil(3*Math.random()),window.imgRandom.set("img",o),t=e.lastIndexOf("."),s=e.substr(t+1),t=["png","jpg","jpeg"],-1!==e.indexOf("//omo.aiyouyi.cn/web-file/")?-1!==t.indexOf(s.toLocaleLowerCase())&&(e=e.replace("//omo.aiyouyi.cn/web-file/","//img".concat(o,".aiyouyi.cn/thumbnail/")+Math.ceil(2*n)+"x10000/")):-1!==t.indexOf(s.toLocaleLowerCase())&&(e=e.replace("web-file/","thumbnail/"+Math.ceil(2*n)+"x10000/")))}return e}(n)),n.attr("src",s).removeAttr("lazy")):(n.removeAttr("lazy"),n.attr("needError","true"),n.trigger("error"))))}$("body").onErrorImg(),$("body img").each(function(){""!=$(this).attr("src")&&"null"!=$(this).attr("src")&&"undefined"!=$(this).attr("src")||$(this).trigger("error")})};return{ready:function(t){function i(o){if(o)return $("div[id^='c_']").stop().removeClass("response-animated"),o.find("div[id^='c_']").stop().addClass("response-animated"),0;$("div[id^='c_']").each(function(){var t=$(this),n=t.attr("id"),e=t.closest('[id^="c_magiccube_005-"]')||t.closest('[id^="c_flipPage-"]'),i=!o&&0<e.length||o&&0==o.find("#"+n).length,a=0<t.closest(".p_header").length,e=t.offset().top+t.height()<=$(window).scrollTop(),n=$(window).scrollTop()+$(window).height()<=t.offset().top;e||n||i&&!a?t.stop().removeClass("response-animated"):t.stop().addClass("response-animated")})}function a(o){if(o)return $("[class^='e_']").stop().removeClass("response-transition"),o.find("[class^='e_']").stop().addClass("response-transition"),0;$("[class^='e_']").each(function(){var t=$(this),n=t.attr("class").split(/\s+/).find(function(t){return/^e_/.test(t)}),e=t.closest('[id^="c_magiccube_005-"]')||t.closest('[id^="c_flipPage-"]'),i=!o&&0<e.length||o&&0==o.find("."+n).length,a=0<t.closest(".p_header").length,e=t.offset().top+t.height()<=$(window).scrollTop()+$(window).height()/4,n=$(window).scrollTop()+$(window).height()/4*3<=t.offset().top;e||n||i&&!a?t.stop().removeClass("response-transition"):t.stop().addClass("response-transition")})}var e,n=$.debounce(function(){i(),"290733"!=tenant.tenantId&&a()});n(),$(window).scroll(n),"290733"==tenant.tenantId&&(e=new IntersectionObserver(function(t,n){var e=t[0],t=e.target;e.isIntersecting?$(t).addClass("response-transition"):$(t).removeClass("response-transition")},{threshold:1}),$("[class^='e_']").each(function(t,n){e.observe(n)})),$(window).on("scrollEnd",function(t,n,e){e=/^c_flipPage-/.test(n)?$("#".concat(n," .p_fslide")).eq(e).length?$("#".concat(n," .p_fslide")).eq(e):$("#".concat(n," .p_footer")):$("#".concat(n," .p_turnPage_slide")).eq(e);i(e),a(e)}),$(window).on("onVisible",function(t,n,e){i(),a()}),$("body").onErrorImg(),$("body img").each(function(){""!=$(this).attr("src")&&"null"!=$(this).attr("src")&&"undefined"!=$(this).attr("src")||$(this).trigger("error")}),c(),l(),t(),o()},lazyImg:function(){window.isDoScrollEvent||($(window).on("scroll",a),$(window).on("resize",a),$(window).on("scrollEnd",a),$(window).on("onVisible",a),$(window).on("loopMarquee",a),window.isDoScrollEvent=!0),a()},assist:l}});