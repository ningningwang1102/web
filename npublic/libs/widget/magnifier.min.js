"use strict";$define("magnifier",["videoPlayer","getFullView","lightbox"],function(){$.fn.magnifier=function(i){var y=$.extend({magnifier:".magnifier",container:".magnifier-container",containerImg:".images-cover",view:".magnifier-view",width:400,height:400,moveView:".move-view",moveWidth:null,moveheight:null,zoom:4,thumbnail:".magnifier-line > ul",assembly:".magnifier-btn",index:0},i);return this.each(function(){var g=$(this),s=g.find(y.container),l=g.find(y.view),o=g.find(y.moveView),m=g.find(y.thumbnail),i=g.find(y.assembly),r=g.find(y.containerImg);s.css({width:y.width,height:y.height}),l.css({width:y.width,height:y.height});var f,c,u,v,w,x,b,p,V=y.moveWidth||(y.width-2)/y.zoom,k=y.moveHeight||(y.height-2)/y.zoom;o.css({width:V,height:k});function t(t){var n=new Image,i=m.find("img").eq(y.index).parent(),e=m.find("img").eq(y.index).attr("src"),d=m.find(".small-img").eq(y.index).attr("data-url"),h=y.index,a=i.attr("data-video"),g=i.parent().hasClass("fullview-img");"/npublic/img/s.png"==e&&(e=$.handleDataImg(d)),n.src=e,n["data-url"]=d;var o=$.handleDataImg([d]);m.find(">*").removeClass("active").eq(y.index).addClass("active"),function i(){var e;0!=n.width?(y.width<=y.height?(w=y.width-2,x=n.height/(n.width/w)):(x=y.height-2,w=n.width/(n.height/x)),(e=r.find(".image-item").eq(t)).length?(e.show().siblings().hide(),e.find("img").attr("index",h).attr("data-url",o).attr("width",w).attr("height",x)):r.empty().append('<img src="'+o+'" index="'+h+'" data-url="'+o+'" width="'+w+'" height="'+x+'"/>'),a?(r.attr("isVideo","isVideo"),s.find(".image-bigger").hide()):(r.attr("isVideo",""),s.find(".image-bigger").show()),g?r.attr("is360","is360"):r.attr("is360",""),b=(y.width-2)/V,p=(y.height-2)/k,l.empty().append('<img src="'+o+'" width="'+w*b+'" height="'+x*p+'" />'),f=(y.width-w)/2,c=y.width-f-V+1,u=(y.height-x)/2,v=y.height-u-k+1,s.find(".videoPlayerCon").remove()):n.onload=i}()}t(0);function n(){return!y.thumbPosition||"left"!=y.thumbPosition&&"right"!=y.thumbPosition?"bt":"lr"}var d,h,a;i.find(">*").on("click",function(){!function(i){var e=m.find(">*"),t=e.length;if(i?y.index++:y.index--,t<=(i="lr"==n()?Math.floor(m.parent().height()/e.height()):Math.ceil(m.parent().width()/e.width())))return;y.index<0?y.index=0:y.index>t-i&&(y.index=t-i),e="lr"==n()?e.outerHeight(!0)*y.index:e.width()*y.index,"lr"==n()?m.css({"margin-top":-e+"px"}):m.css({left:-e+"px"})}($(this).index())}),m.on("click",">*",function(i,e){$(this).hasClass("video-img")?g.find(".image-big-video").show():g.find(".image-big-video").hide(),0==$(this).index()?g.find(".js-icons").show():g.find(".js-icons").hide(),y.index=void 0!==e?e:$(this).index(),t($(this).index())}),o.click(function(){r.trigger("click")}),s.children(".image-big-video").click(function(){r.trigger("click")}),r.off("click").on("click",function(i){o.hide(),l.hide(),h=($(this).find(".image-item:visible img").length?$(this).find(".image-item:visible img"):$(this).find("img")).attr("index");var e,t,n,d,h,a=m.find("li").eq(h);a.hasClass("video-img")?(t=a.find(".small-img").data("video"),e=$.handleDataVideo(t),t=s,isMo()&&!y.videoStatic&&(t=null),$.playVideo({url:e,container:t})):a.hasClass("fullview-img")?(t=y.fullViewImages,n=[],t.map(function(i){i=$.handleDataImg([i.url]);return n.push(i)}),$.seeFullView({imageList:n,length:n.length})):a.hasClass("static-img")&&(d=[],0==(a=g.find(".thumbnail_box").find(".static-img")).length&&(a=g.find(".p_thumbnail_box").find(".static-img")),a&&a.each(function(i,e){e=$.handleDataImg([$(e).find(".small-img").data("url")]);d.push({url:e})}),h=h-m.find(".video-img").length-m.find(".fullview-img").length,0<d.length&&$.lightbox({images:d,activeIndex:h}))}),isMo()||-1==y.zoom?(d=0,h=($(this).find(".image-item:visible img").length?$(this).find(".image-item:visible img"):$(this).find("img")).attr("index"),a=m.children().length-1,s.on("touchstart",function(i){h=($(this).find(".image-item:visible img").length?$(this).find(".image-item:visible img"):$(this).find("img")).attr("index"),d=i.originalEvent.changedTouches[0].pageX}),s.on("touchend",function(i){var e=i.originalEvent.changedTouches[0].pageX,i=!1;20<e-d?(--h<0&&(h=a),i=!0):e-d<-20&&(a<++h&&(h=0),i=!0),i&&m.find("li").eq(h).trigger("click",h)})):s.on("mousemove",function(i){return!(0<s.find(".videoPlayerCon").length)&&("isVideo"!=r.attr("isVideo")||y.videoFd)&&("is360"!=r.attr("is360")||y.fd360)?void function(i){var e=i.clientX-s.offset().left-V/2,i=i.clientY-s.offset().top+$(document).scrollTop()-k/2,e=f<e?e<c?e:c:f,i=0<(i=u<i?i<v?i:v:u)?i>y.height-k?y.height-k:i:0,e=0<e?e>y.width-V?y.width-V:e:0;o.css({left:e,top:i,display:"block"});e=(e-(y.width-w)/2)*b,i=(i-(y.height-x)/2)*p;l.css({display:"block"}).find("img").css({"margin-left":-e,"margin-top":-i})}(i):(o.hide(),void l.hide())}).on("mouseleave",function(){o.hide(),l.hide()})})}});